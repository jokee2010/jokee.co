<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UGX Marketplace - E-Commerce Platform</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
            --dark-color: #1f2937;
            --light-color: #f9fafb;
            --purple-color: #8b5cf6;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: #f8fafc;
            color: #334155;
        }
        
        /* Login Page Styles */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.8s ease-out;
        }
        
        .login-brand {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-brand h1 {
            color: var(--primary-color);
            font-weight: 800;
            font-size: 2.5rem;
            margin-bottom: 5px;
        }
        
        .login-brand p {
            color: #64748b;
            font-size: 1.1rem;
        }
        
        .login-form .form-control {
            padding: 12px 15px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }
        
        .login-form .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .login-options {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .login-options .btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        .demo-accounts {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 10px;
            margin-top: 25px;
        }
        
        /* Registration Page */
        .registration-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }
        
        .registration-steps::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 10%;
            right: 10%;
            height: 2px;
            background: #e2e8f0;
            z-index: 1;
        }
        
        .step {
            position: relative;
            z-index: 2;
            text-align: center;
            flex: 1;
        }
        
        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e2e8f0;
            color: #64748b;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .step.active .step-circle {
            background: var(--primary-color);
            color: white;
        }
        
        .step-label {
            font-size: 0.85rem;
            color: #64748b;
        }
        
        .step.active .step-label {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        /* Navigation */
        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--primary-color) !important;
        }
        
        .currency {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        /* Cards */
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.3s, box-shadow 0.3s;
            margin-bottom: 1.5rem;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .product-img {
            height: 200px;
            object-fit: cover;
            border-radius: 8px 8px 0 0;
        }
        
        /* Buttons */
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        /* Chat Windows */
        .chat-window {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 15px;
            padding: 15px;
            background-color: #f9fafb;
        }
        
        .message {
            padding: 12px 16px;
            border-radius: 18px;
            margin-bottom: 10px;
            max-width: 70%;
            word-wrap: break-word;
            animation: fadeInUp 0.3s ease-out;
        }
        
        .user-message {
            background: linear-gradient(135deg, var(--primary-color), #4f46e5);
            color: white;
            margin-left: auto;
        }
        
        .admin-message {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            margin-right: auto;
        }
        
        /* Chat indicators */
        .chat-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .chat-unread {
            background-color: #ef4444;
            animation: pulse 2s infinite;
        }
        
        .chat-read {
            background-color: #10b981;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Tabs */
        .nav-tabs .nav-link {
            color: #64748b;
            font-weight: 600;
            border: none;
            padding: 12px 25px;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s;
        }
        
        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            background-color: white;
            border-bottom: 3px solid var(--primary-color);
        }
        
        /* Admin Dashboard */
        .admin-sidebar {
            background: linear-gradient(180deg, #1e293b, #0f172a);
            color: white;
            min-height: calc(100vh - 76px);
            padding-top: 20px;
        }
        
        .admin-sidebar .nav-link {
            color: #cbd5e1;
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 5px;
            transition: all 0.2s;
        }
        
        .admin-sidebar .nav-link:hover, 
        .admin-sidebar .nav-link.active {
            background: linear-gradient(90deg, var(--primary-color), var(--purple-color));
            color: white;
            transform: translateX(5px);
        }
        
        /* Stats Cards */
        .stat-card {
            text-align: center;
            padding: 25px;
            border-radius: 15px;
            color: white;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card.orders {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .stat-card.revenue {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .stat-card.products {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .stat-card.chats {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        
        /* Hidden Class */
        .hidden {
            display: none !important;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Admin Data Tables */
        .data-table {
            font-size: 0.9rem;
        }
        
        .data-table th {
            font-weight: 600;
            background: #f8fafc;
        }
        
        /* Status Badges */
        .badge-pending { background-color: #f59e0b; }
        .badge-processing { background-color: #3b82f6; }
        .badge-shipped { background-color: #8b5cf6; }
        .badge-delivered { background-color: #10b981; }
        .badge-cancelled { background-color: #ef4444; }
        
        /* Dashboard Metrics */
        .metric-card {
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            background: white;
            border-radius: 8px;
        }
        
        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark-color);
        }
        
        .metric-label {
            color: #64748b;
            font-size: 0.9rem;
        }
        
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
        
        .toast {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary-color);
        }
        
        /* Form Validation */
        .form-control.is-invalid {
            border-color: #ef4444;
        }
        
        .form-control.is-valid {
            border-color: #10b981;
        }
        
        .validation-error {
            color: #ef4444;
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .login-container {
                padding: 10px;
            }
            
            .login-card {
                padding: 25px;
            }
            
            .login-options {
                flex-direction: column;
            }
            
            .chat-window {
                height: 300px;
            }
            
            .admin-sidebar {
                min-height: auto;
                margin-bottom: 20px;
            }
            
            .registration-steps {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="login-brand">
                <h1><i class="fas fa-shopping-bag me-2"></i>UGX Marketplace</h1>
                <p>Your Premier E-Commerce Platform</p>
            </div>
            
            <!-- Login Form -->
            <form id="loginForm" class="login-form">
                <div class="mb-3">
                    <label for="email" class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="email" placeholder="Enter your email" required>
                    <div class="validation-error" id="emailError"></div>
                </div>
                
                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" placeholder="Enter your password" required>
                    <div class="validation-error" id="passwordError"></div>
                </div>
                
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="rememberMe">
                    <label class="form-check-label" for="rememberMe">Remember me</label>
                    <a href="#" class="float-end text-decoration-none" onclick="showForgotPassword()">Forgot Password?</a>
                </div>
                
                <div class="login-options">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt me-2"></i> Login
                    </button>
                    <button type="button" class="btn btn-outline-primary" onclick="showRegistration()">
                        <i class="fas fa-user-plus me-2"></i> Register
                    </button>
                </div>
                
                <div class="demo-accounts mt-4">
                    <h6 class="fw-bold mb-2">Demo Accounts:</h6>
                    <p class="mb-1 small"><strong>Customer:</strong> customer@example.com / pass: demo123</p>
                    <p class="mb-1 small"><strong>Admin:</strong> admin@example.com / pass: admin123</p>
                    <p class="mb-0 small"><strong>Vendor:</strong> vendor@example.com / pass: vendor123</p>
                </div>
            </form>
            
            <!-- Registration Form (Hidden) -->
            <form id="registrationForm" class="login-form hidden">
                <div class="registration-steps">
                    <div class="step active" id="step1">
                        <div class="step-circle">1</div>
                        <div class="step-label">Account Info</div>
                    </div>
                    <div class="step" id="step2">
                        <div class="step-circle">2</div>
                        <div class="step-label">Personal Details</div>
                    </div>
                    <div class="step" id="step3">
                        <div class="step-circle">3</div>
                        <div class="step-label">Complete</div>
                    </div>
                </div>
                
                <div id="registrationStep1">
                    <h5 class="fw-bold mb-3">Account Information</h5>
                    <div class="mb-3">
                        <label class="form-label">Account Type</label>
                        <select class="form-select" id="accountType" required>
                            <option value="">Select Account Type</option>
                            <option value="customer">Customer</option>
                            <option value="vendor">Vendor</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="regEmail" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="regPassword" minlength="6" required>
                        <small class="text-muted">Must be at least 6 characters</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Confirm Password</label>
                        <input type="password" class="form-control" id="regConfirmPassword" required>
                    </div>
                    <div class="d-flex justify-content-between">
                        <button type="button" class="btn btn-secondary" onclick="showLogin()">Back to Login</button>
                        <button type="button" class="btn btn-primary" onclick="nextRegistrationStep(2)">Next</button>
                    </div>
                </div>
                
                <div id="registrationStep2" class="hidden">
                    <h5 class="fw-bold mb-3">Personal Details</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">First Name</label>
                            <input type="text" class="form-control" id="firstName" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="lastName" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-control" id="phone">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Address</label>
                        <textarea class="form-control" id="address" rows="2"></textarea>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="terms" required>
                        <label class="form-check-label" for="terms">
                            I agree to the <a href="#" onclick="showTerms()">Terms & Conditions</a>
                        </label>
                    </div>
                    <div class="d-flex justify-content-between">
                        <button type="button" class="btn btn-secondary" onclick="nextRegistrationStep(1)">Previous</button>
                        <button type="button" class="btn btn-primary" onclick="completeRegistration()">Complete Registration</button>
                    </div>
                </div>
                
                <div id="registrationStep3" class="hidden">
                    <div class="text-center py-4">
                        <div class="mb-3">
                            <i class="fas fa-check-circle text-success fa-4x"></i>
                        </div>
                        <h5 class="fw-bold">Registration Successful!</h5>
                        <p class="text-muted">Your account has been created successfully.</p>
                        <button type="button" class="btn btn-primary" onclick="showLogin()">Go to Login</button>
                    </div>
                </div>
            </form>
            
            <!-- Forgot Password Form (Hidden) -->
            <form id="forgotPasswordForm" class="login-form hidden">
                <h5 class="fw-bold mb-3">Reset Password</h5>
                <div class="mb-3">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="resetEmail" placeholder="Enter your email" required>
                </div>
                <p class="text-muted small mb-3">
                    Enter your email address and we'll send you a link to reset your password.
                </p>
                <div class="d-flex justify-content-between">
                    <button type="button" class="btn btn-secondary" onclick="showLogin()">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="sendResetLink()">Send Reset Link</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div id="appContainer" class="hidden">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-shopping-bag me-2"></i>UGX Marketplace
                </a>
                
                <div class="d-flex align-items-center">
                    <div class="dropdown me-3">
                        <button class="btn btn-outline-primary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-bell"></i>
                            <span class="badge bg-danger" id="notificationCount">3</span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end" style="width: 300px;">
                            <h6 class="dropdown-header">Notifications</h6>
                            <div id="notificationList" style="max-height: 300px; overflow-y: auto;">
                                <!-- Notifications will be loaded here -->
                            </div>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item text-center" href="#" onclick="markAllAsRead()">Mark all as read</a>
                        </div>
                    </div>
                    
                    <span class="me-3 fw-bold" id="currentUser"></span>
                    <div class="btn-group">
                        <button type="button" class="btn btn-outline-primary btn-sm" id="accountTypeBadge">Customer</button>
                        <button class="btn btn-outline-primary btn-sm" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Customer Interface -->
        <div id="customerInterface" class="hidden">
            <div class="container-fluid mt-4">
                <!-- Customer Tabs -->
                <ul class="nav nav-tabs" id="customerTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="store-tab" data-bs-toggle="tab" data-bs-target="#store" type="button" role="tab">
                            <i class="fas fa-store me-2"></i>Store
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="cart-tab" data-bs-toggle="tab" data-bs-target="#cart" type="button" role="tab" onclick="loadCart()">
                            <i class="fas fa-shopping-cart me-2"></i>Cart
                            <span class="badge bg-danger ms-1" id="cartCount">0</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="chats-tab" data-bs-toggle="tab" data-bs-target="#chats" type="button" role="tab" onclick="loadCustomerChats()">
                            <i class="fas fa-comments me-2"></i>Chats
                            <span class="badge bg-danger ms-1" id="unreadChatsCount">0</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="orders-tab" data-bs-toggle="tab" data-bs-target="#orders" type="button" role="tab" onclick="loadCustomerOrders()">
                            <i class="fas fa-shopping-bag me-2"></i>My Orders
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab">
                            <i class="fas fa-cog me-2"></i>Settings
                        </button>
                    </li>
                </ul>
                
                <!-- Customer Tab Content -->
                <div class="tab-content mt-3" id="customerTabContent">
                    <!-- Store Tab -->
                    <div class="tab-pane fade show active" id="store" role="tabpanel">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h3 class="fw-bold">Products</h3>
                            <div class="d-flex">
                                <div class="input-group me-2" style="width: 300px;">
                                    <input type="text" class="form-control" placeholder="Search products..." id="productSearch">
                                    <button class="btn btn-outline-primary" type="button" onclick="searchProducts()">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                                <div class="dropdown">
                                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        <i class="fas fa-filter me-2"></i>Filter
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#" onclick="filterProducts('all')">All Products</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="filterProducts('electronics')">Electronics</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="filterProducts('fashion')">Fashion</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="filterProducts('home')">Home & Living</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="filterProducts('price-low-high')">Price: Low to High</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="filterProducts('price-high-low')">Price: High to Low</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Product Grid -->
                        <div class="row" id="productGrid">
                            <!-- Products will be dynamically loaded here -->
                        </div>
                    </div>
                    
                    <!-- Cart Tab -->
                    <div class="tab-pane fade" id="cart" role="tabpanel">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h3 class="fw-bold">Shopping Cart</h3>
                            <button class="btn btn-danger btn-sm" onclick="clearCart()" id="clearCartBtn" disabled>
                                <i class="fas fa-trash me-1"></i>Clear Cart
                            </button>
                        </div>
                        
                        <div id="cartContent">
                            <!-- Cart items will be loaded here -->
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title fw-bold">Cart Summary</h5>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Subtotal:</span>
                                            <span id="cartSubtotal">0 UGX</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Shipping:</span>
                                            <span id="cartShipping">10,000 UGX</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Tax (18%):</span>
                                            <span id="cartTax">0 UGX</span>
                                        </div>
                                        <hr>
                                        <div class="d-flex justify-content-between fw-bold">
                                            <span>Total:</span>
                                            <span id="cartTotal">0 UGX</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title fw-bold">Checkout</h5>
                                        <div class="mb-3">
                                            <label class="form-label">Shipping Address</label>
                                            <textarea class="form-control" id="shippingAddress" rows="3"></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Payment Method</label>
                                            <select class="form-select" id="paymentMethod">
                                                <option value="mobile_money">Mobile Money</option>
                                                <option value="credit_card">Credit Card</option>
                                                <option value="cash_on_delivery">Cash on Delivery</option>
                                            </select>
                                        </div>
                                        <button class="btn btn-primary w-100" onclick="processOrder()" id="checkoutBtn" disabled>
                                            <i class="fas fa-lock me-2"></i>Proceed to Checkout
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chats Tab -->
                    <div class="tab-pane fade" id="chats" role="tabpanel">
                        <div class="row">
                            <!-- Chat List -->
                            <div class="col-md-4">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h4 class="fw-bold">My Chats</h4>
                                    <button class="btn btn-sm btn-outline-primary" onclick="startNewChat()">
                                        <i class="fas fa-plus me-1"></i>New Chat
                                    </button>
                                </div>
                                <div class="list-group" id="chatList">
                                    <!-- Chat items will be loaded here -->
                                </div>
                            </div>
                            
                            <!-- Chat Window -->
                            <div class="col-md-8">
                                <div id="activeChatContainer">
                                    <div class="text-center text-muted py-5" id="noChatSelected">
                                        <i class="fas fa-comments fa-3x mb-3"></i>
                                        <h5>Select a chat to start messaging</h5>
                                        <p>Click on a chat from the list or start a new one</p>
                                    </div>
                                    
                                    <!-- Active Chat (hidden by default) -->
                                    <div class="hidden" id="activeChat">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h5 id="chatProductName"></h5>
                                            <span class="badge bg-warning" id="chatStatusBadge">Active</span>
                                        </div>
                                        
                                        <div class="chat-window mb-3" id="chatMessages">
                                            <!-- Messages will be loaded here -->
                                        </div>
                                        
                                        <div class="input-group">
                                            <input type="text" class="form-control" placeholder="Type your message..." id="chatInput" onkeypress="handleChatKeyPress(event)">
                                            <button class="btn btn-primary" onclick="sendMessage()">
                                                <i class="fas fa-paper-plane"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Orders Tab -->
                    <div class="tab-pane fade" id="orders" role="tabpanel">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h3 class="fw-bold">My Order History</h3>
                            <button class="btn btn-outline-primary" onclick="refreshOrders()">
                                <i class="fas fa-sync-alt me-2"></i>Refresh
                            </button>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-hover data-table">
                                <thead class="table-light">
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Date</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="customerOrdersTable">
                                    <!-- Orders will be dynamically loaded here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Order Details Modal -->
                        <div class="modal fade" id="orderDetailsModal" tabindex="-1">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Order Details #<span id="modalOrderId"></span></h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body" id="orderDetailsContent">
                                        <!-- Order details will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Settings Tab -->
                    <div class="tab-pane fade" id="settings" role="tabpanel">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title fw-bold">Account Settings</h5>
                                        <div class="text-center mb-3">
                                            <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
                                                <i class="fas fa-user text-white fa-2x"></i>
                                            </div>
                                            <h5 class="mt-2" id="customerName">John Customer</h5>
                                            <p class="text-muted" id="customerEmail">customer@example.com</p>
                                            <span class="badge bg-primary" id="customerTypeBadge">Customer</span>
                                        </div>
                                        
                                        <div class="list-group list-group-flush">
                                            <a href="#" class="list-group-item list-group-item-action" onclick="showEditProfile()">
                                                <i class="fas fa-user-edit me-2"></i>Edit Profile
                                            </a>
                                            <a href="#" class="list-group-item list-group-item-action" onclick="showChangePassword()">
                                                <i class="fas fa-lock me-2"></i>Change Password
                                            </a>
                                            <a href="#" class="list-group-item list-group-item-action" onclick="showAddressBook()">
                                                <i class="fas fa-map-marker-alt me-2"></i>Shipping Addresses
                                            </a>
                                            <a href="#" class="list-group-item list-group-item-action" onclick="showPaymentMethods()">
                                                <i class="fas fa-credit-card me-2"></i>Payment Methods
                                            </a>
                                            <a href="#" class="list-group-item list-group-item-action" onclick="showNotificationsSettings()">
                                                <i class="fas fa-bell me-2"></i>Notifications
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-8">
                                <!-- Edit Profile Form -->
                                <div id="editProfileSection">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title fw-bold">Edit Profile</h5>
                                            <form id="profileForm">
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">First Name</label>
                                                        <input type="text" class="form-control" id="editFirstName" value="John">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Last Name</label>
                                                        <input type="text" class="form-control" id="editLastName" value="Customer">
                                                    </div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label class="form-label">Email Address</label>
                                                    <input type="email" class="form-control" id="editEmail" value="customer@example.com" readonly>
                                                    <small class="text-muted">Email cannot be changed</small>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label class="form-label">Phone Number</label>
                                                    <input type="tel" class="form-control" id="editPhone" value="+256 700 000 000">
                                                </div>
                                                
                                                <button type="submit" class="btn btn-primary">Save Changes</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Interface -->
        <div id="adminInterface" class="hidden">
            <div class="container-fluid">
                <div class="row">
                    <!-- Admin Sidebar -->
                    <div class="col-lg-2 col-md-3 admin-sidebar">
                        <div class="text-center mb-4">
                            <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 60px; height: 60px;">
                                <i class="fas fa-user-shield text-white fa-lg"></i>
                            </div>
                            <h6 class="fw-bold">Admin Dashboard</h6>
                            <small class="text-muted">Administrator</small>
                        </div>
                        
                        <ul class="nav flex-column" id="adminNav">
                            <li class="nav-item">
                                <a class="nav-link active" href="#" onclick="showAdminSection('dashboard')">
                                    <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="showAdminSection('orders')">
                                    <i class="fas fa-shopping-cart me-2"></i>Manage Orders
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="showAdminSection('products')">
                                    <i class="fas fa-box-open me-2"></i>Manage Products
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="showAdminSection('inventory')">
                                    <i class="fas fa-warehouse me-2"></i>Inventory
                                    <span class="badge bg-danger float-end mt-1" id="lowStockCount">0</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="showAdminSection('upload')">
                                    <i class="fas fa-upload me-2"></i>Upload Products
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="showAdminSection('chats')">
                                    <i class="fas fa-comments me-2"></i>Customer Chats
                                    <span class="badge bg-danger float-end mt-1" id="adminUnreadChats">0</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="showAdminSection('customers')">
                                    <i class="fas fa-users me-2"></i>Customers
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="showAdminSection('vendors')">
                                    <i class="fas fa-store me-2"></i>Vendors
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="showAdminSection('analytics')">
                                    <i class="fas fa-chart-bar me-2"></i>Analytics
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="showAdminSection('reports')">
                                    <i class="fas fa-file-alt me-2"></i>Reports
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="showAdminSection('promotions')">
                                    <i class="fas fa-tags me-2"></i>Promotions
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="showAdminSection('settings')">
                                    <i class="fas fa-cogs me-2"></i>Settings
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Admin Main Content -->
                    <div class="col-lg-10 col-md-9 mt-4">
                        <!-- Dashboard Section -->
                        <div id="adminDashboard">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h3 class="fw-bold">Admin Dashboard</h3>
                                <div class="d-flex">
                                    <button class="btn btn-sm btn-outline-primary me-2" onclick="refreshDashboard()">
                                        <i class="fas fa-sync-alt me-1"></i>Refresh
                                    </button>
                                    <button class="btn btn-sm btn-primary" onclick="generateDashboardReport()">
                                        <i class="fas fa-download me-1"></i>Export Report
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Quick Stats -->
                            <div class="row mb-4">
                                <div class="col-xl-3 col-md-6 mb-3">
                                    <div class="metric-card">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <div class="metric-value" id="totalOrders">0</div>
                                                <div class="metric-label">Total Orders</div>
                                            </div>
                                            <i class="fas fa-shopping-cart fa-2x text-primary"></i>
                                        </div>
                                        <div class="mt-2">
                                            <small class="text-success"><i class="fas fa-arrow-up me-1"></i>12% from last month</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-3 col-md-6 mb-3">
                                    <div class="metric-card" style="border-left-color: #10b981;">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <div class="metric-value" id="totalRevenue">0 UGX</div>
                                                <div class="metric-label">Total Revenue</div>
                                            </div>
                                            <i class="fas fa-money-bill-wave fa-2x text-success"></i>
                                        </div>
                                        <div class="mt-2">
                                            <small class="text-success"><i class="fas fa-arrow-up me-1"></i>18% from last month</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-3 col-md-6 mb-3">
                                    <div class="metric-card" style="border-left-color: #8b5cf6;">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <div class="metric-value" id="totalProducts">0</div>
                                                <div class="metric-label">Total Products</div>
                                            </div>
                                            <i class="fas fa-box-open fa-2x text-purple"></i>
                                        </div>
                                        <div class="mt-2">
                                            <small class="text-success"><i class="fas fa-arrow-up me-1"></i>5 new this week</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-3 col-md-6 mb-3">
                                    <div class="metric-card" style="border-left-color: #f59e0b;">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <div class="metric-value" id="activeChats">0</div>
                                                <div class="metric-label">Active Chats</div>
                                            </div>
                                            <i class="fas fa-comments fa-2x text-warning"></i>
                                        </div>
                                        <div class="mt-2">
                                            <small class="text-danger"><i class="fas fa-exclamation-circle me-1"></i>3 require attention</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Charts Row -->
                            <div class="row mb-4">
                                <div class="col-md-8">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <h5 class="card-title fw-bold mb-0">Sales Overview</h5>
                                                <div class="btn-group btn-group-sm">
                                                    <button class="btn btn-outline-secondary active" onclick="setChartPeriod('week')">Week</button>
                                                    <button class="btn btn-outline-secondary" onclick="setChartPeriod('month')">Month</button>
                                                    <button class="btn btn-outline-secondary" onclick="setChartPeriod('year')">Year</button>
                                                </div>
                                            </div>
                                            <canvas id="salesChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title fw-bold">Top Products</h5>
                                            <div class="list-group list-group-flush" id="topProductsList">
                                                <!-- Top products will be loaded here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Recent Activity -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title fw-bold">Recent Orders</h5>
                                            <div class="table-responsive">
                                                <table class="table table-sm data-table">
                                                    <thead>
                                                        <tr>
                                                            <th>Order ID</th>
                                                            <th>Customer</th>
                                                            <th>Amount</th>
                                                            <th>Status</th>
                                                            <th>Action</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="recentOrdersTable">
                                                        <!-- Recent orders will be loaded here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title fw-bold">System Alerts</h5>
                                            <div id="systemAlerts">
                                                <!-- Alerts will be loaded here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Manage Orders Section -->
                        <div id="adminOrders" class="hidden">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h3 class="fw-bold">Manage Orders</h3>
                                <div class="d-flex">
                                    <div class="input-group me-2" style="width: 250px;">
                                        <input type="text" class="form-control" placeholder="Search orders..." id="orderSearch">
                                        <button class="btn btn-outline-primary" type="button" onclick="searchOrders()">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                    <div class="dropdown me-2">
                                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                            Filter by Status
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" href="#" onclick="filterOrders('all')">All Orders</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="filterOrders('pending')">Pending</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="filterOrders('processing')">Processing</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="filterOrders('shipped')">Shipped</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="filterOrders('delivered')">Delivered</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="filterOrders('cancelled')">Cancelled</a></li>
                                        </ul>
                                    </div>
                                    <button class="btn btn-primary" onclick="showBulkOrderUpdate()">
                                        <i class="fas fa-edit me-2"></i>Bulk Update
                                    </button>
                                </div>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="table table-hover data-table">
                                    <thead class="table-light">
                                        <tr>
                                            <th>
                                                <input type="checkbox" id="selectAllOrders">
                                            </th>
                                            <th>Order ID</th>
                                            <th>Customer</th>
                                            <th>Date</th>
                                            <th>Items</th>
                                            <th>Total</th>
                                            <th>Status</th>
                                            <th>Payment</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="adminOrdersTable">
                                        <!-- Admin orders will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <div>
                                    <button class="btn btn-success btn-sm me-2" onclick="approveSelectedOrders()">
                                        <i class="fas fa-check me-1"></i>Approve Selected
                                    </button>
                                    <button class="btn btn-warning btn-sm me-2" onclick="updateOrderStatus('processing')">
                                        <i class="fas fa-sync-alt me-1"></i>Mark as Processing
                                    </button>
                                    <button class="btn btn-info btn-sm me-2" onclick="updateOrderStatus('shipped')">
                                        <i class="fas fa-shipping-fast me-1"></i>Mark as Shipped
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="cancelSelectedOrders()">
                                        <i class="fas fa-times me-1"></i>Cancel Selected
                                    </button>
                                </div>
                                <div>
                                    <button class="btn btn-outline-primary btn-sm me-2" onclick="exportOrders('csv')">
                                        <i class="fas fa-download me-1"></i>Export as CSV
                                    </button>
                                    <button class="btn btn-outline-primary btn-sm" onclick="exportOrders('pdf')">
                                        <i class="fas fa-file-pdf me-1"></i>Export as PDF
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Manage Products Section -->
                        <div id="adminProducts" class="hidden">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h3 class="fw-bold">Manage Products</h3>
                                <div class="d-flex">
                                    <div class="input-group me-2" style="width: 250px;">
                                        <input type="text" class="form-control" placeholder="Search products..." id="adminProductSearch">
                                        <button class="btn btn-outline-primary" type="button" onclick="searchAdminProducts()">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                    <button class="btn btn-primary" onclick="showAdminSection('upload')">
                                        <i class="fas fa-plus me-2"></i>Add New Product
                                    </button>
                                </div>
                            </div>
                            
                            <div class="row" id="adminProductGrid">
                                <!-- Products for admin management will be loaded here -->
                            </div>
                        </div>
                        
                        <!-- Inventory Management -->
                        <div id="adminInventory" class="hidden">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h3 class="fw-bold">Inventory Management</h3>
                                <button class="btn btn-primary" onclick="showBulkStockUpdate()">
                                    <i class="fas fa-edit me-2"></i>Bulk Stock Update
                                </button>
                            </div>
                            
                            <!-- Inventory Alerts -->
                            <div class="alert alert-warning mb-4">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong id="lowStockAlertCount">0 products</strong> are running low on stock. 
                                <a href="#" class="alert-link" onclick="showLowStockItems()">View all low stock items</a>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="table table-hover data-table">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Product ID</th>
                                            <th>Product Name</th>
                                            <th>Category</th>
                                            <th>Current Stock</th>
                                            <th>Minimum Stock</th>
                                            <th>Status</th>
                                            <th>Last Updated</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inventoryTable">
                                        <!-- Inventory items will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Upload Products Section -->
                        <div id="adminUpload" class="hidden">
                            <div class="row">
                                <div class="col-lg-8">
                                    <div class="card">
                                        <div class="card-body">
                                            <h3 class="fw-bold mb-4">Upload New Product</h3>
                                            <form id="uploadProductForm">
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Product Name</label>
                                                        <input type="text" class="form-control" id="productName" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Category</label>
                                                        <select class="form-select" id="productCategory" required>
                                                            <option value="">Select Category</option>
                                                            <option value="electronics">Electronics</option>
                                                            <option value="fashion">Fashion</option>
                                                            <option value="home">Home & Living</option>
                                                            <option value="beauty">Beauty & Health</option>
                                                            <option value="sports">Sports & Outdoors</option>
                                                            <option value="groceries">Groceries</option>
                                                            <option value="books">Books & Stationery</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                
                                                <div class="row">
                                                    <div class="col-md-4 mb-3">
                                                        <label class="form-label">Price (UGX)</label>
                                                        <input type="number" class="form-control" id="productPrice" min="0" step="1000" required>
                                                    </div>
                                                    <div class="col-md-4 mb-3">
                                                        <label class="form-label">Stock Quantity</label>
                                                        <input type="number" class="form-control" id="productStock" min="0" required>
                                                    </div>
                                                    <div class="col-md-4 mb-3">
                                                        <label class="form-label">Minimum Stock</label>
                                                        <input type="number" class="form-control" id="productMinStock" min="0" value="10">
                                                    </div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label class="form-label">Product Description</label>
                                                    <textarea class="form-control" id="productDescription" rows="4" required></textarea>
                                                </div>
                                                
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Product Image URL</label>
                                                        <input type="text" class="form-control" id="productImageUrl" placeholder="https://example.com/image.jpg" required>
                                                        <small class="text-muted">Enter a valid image URL for the product</small>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Brand</label>
                                                        <input type="text" class="form-control" id="productBrand" placeholder="Enter brand name">
                                                    </div>
                                                </div>
                                                
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Weight (kg)</label>
                                                        <input type="number" class="form-control" id="productWeight" min="0" step="0.1">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Dimensions (LWH cm)</label>
                                                        <input type="text" class="form-control" id="productDimensions" placeholder="e.g., 201510">
                                                    </div>
                                                </div>
                                                
                                                <div class="d-flex justify-content-between">
                                                    <button type="button" class="btn btn-secondary" onclick="resetUploadForm()">Reset Form</button>
                                                    <button type="submit" class="btn btn-primary">Upload Product</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-lg-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title fw-bold">Upload Guidelines</h5>
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item">
                                                    <i class="fas fa-check-circle text-success me-2"></i>
                                                    Use high-quality images
                                                </li>
                                                <li class="list-group-item">
                                                    <i class="fas fa-check-circle text-success me-2"></i>
                                                    Provide accurate descriptions
                                                </li>
                                                <li class="list-group-item">
                                                    <i class="fas fa-check-circle text-success me-2"></i>
                                                    Set competitive prices in UGX
                                                </li>
                                                <li class="list-group-item">
                                                    <i class="fas fa-check-circle text-success me-2"></i>
                                                    Categorize products correctly
                                                </li>
                                                <li class="list-group-item">
                                                    <i class="fas fa-check-circle text-success me-2"></i>
                                                    Update stock regularly
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    
                                    <div class="card mt-3">
                                        <div class="card-body">
                                            <h5 class="card-title fw-bold">Bulk Upload</h5>
                                            <p class="card-text">Upload multiple products at once using CSV.</p>
                                            <div class="mb-3">
                                                <label class="form-label">CSV File</label>
                                                <input type="file" class="form-control" id="bulkUploadFile" accept=".csv">
                                            </div>
                                            <button class="btn btn-outline-primary w-100" onclick="processBulkUpload()">
                                                <i class="fas fa-upload me-2"></i>Upload CSV
                                            </button>
                                            <a href="#" class="btn btn-link w-100 mt-2" onclick="downloadTemplate()">
                                                <i class="fas fa-download me-2"></i>Download Template
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Customer Chats Section -->
                        <div id="adminChats" class="hidden">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h4 class="fw-bold">Customer Chats</h4>
                                        <span class="badge bg-danger" id="totalUnreadChats">0 Unread</span>
                                    </div>
                                    
                                    <div class="list-group" id="adminChatList">
                                        <!-- Admin chat list will be loaded here -->
                                    </div>
                                </div>
                                
                                <div class="col-md-8">
                                    <div id="adminActiveChatContainer">
                                        <div class="text-center text-muted py-5" id="adminNoChatSelected">
                                            <i class="fas fa-headset fa-3x mb-3"></i>
                                            <h5>Select a customer chat to respond</h5>
                                            <p>Click on a chat from the list to view messages</p>
                                        </div>
                                        
                                        <!-- Admin Active Chat -->
                                        <div class="hidden" id="adminActiveChat">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <div>
                                                    <h5 id="adminChatProductName"></h5>
                                                    <p class="text-muted mb-0" id="adminChatCustomer"></p>
                                                </div>
                                                <div>
                                                    <button class="btn btn-sm btn-outline-success me-2" onclick="markChatAsResolved()">
                                                        <i class="fas fa-check me-1"></i>Mark Resolved
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-warning me-2" onclick="reopenChat()">
                                                        <i class="fas fa-redo me-1"></i>Reopen
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-info" onclick="exportChat()">
                                                        <i class="fas fa-download me-1"></i>Export Chat
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div class="chat-window mb-3" id="adminChatMessages">
                                                <!-- Admin chat messages will be loaded here -->
                                            </div>
                                            
                                            <div class="input-group mb-3">
                                                <input type="text" class="form-control" placeholder="Type your reply as admin..." id="adminChatInput" onkeypress="handleAdminChatKeyPress(event)">
                                                <button class="btn btn-primary" onclick="sendAdminReply()">
                                                    <i class="fas fa-paper-plane"></i>
                                                </button>
                                            </div>
                                            
                                            <div class="mt-3">
                                                <h6>Quick Responses</h6>
                                                <div class="d-flex flex-wrap gap-2">
                                                    <button class="btn btn-sm btn-outline-secondary" onclick="useQuickResponse('We have received your inquiry and will get back to you shortly.')">
                                                        Will get back to you
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-secondary" onclick="useQuickResponse('This item is currently in stock and available for purchase.')">
                                                        Item in stock
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-secondary" onclick="useQuickResponse('Your order is being processed and will ship soon.')">
                                                        Order processing
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-secondary" onclick="useQuickResponse('Please provide more details about your issue.')">
                                                        Need more details
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-secondary" onclick="useQuickResponse('Thank you for your purchase! Your order will be delivered within 3-5 business days.')">
                                                        Delivery estimate
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Customers Section -->
                        <div id="adminCustomers" class="hidden">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h3 class="fw-bold">Customer Management</h3>
                                <div class="d-flex">
                                    <div class="input-group me-2" style="width: 250px;">
                                        <input type="text" class="form-control" placeholder="Search customers..." id="customerSearch">
                                        <button class="btn btn-outline-primary" type="button" onclick="searchCustomers()">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                    <button class="btn btn-primary" onclick="addNewCustomer()">
                                        <i class="fas fa-plus me-2"></i>Add Customer
                                    </button>
                                </div>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="table table-hover data-table">
                                    <thead class="table-light">
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Phone</th>
                                            <th>Orders</th>
                                            <th>Total Spent</th>
                                            <th>Joined</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="customersTable">
                                        <!-- Customers will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Customer Details Modal -->
                            <div class="modal fade" id="customerDetailsModal" tabindex="-1">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">Customer Details</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body" id="customerDetailsContent">
                                            <!-- Customer details will be loaded here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Vendors Section -->
                        <div id="adminVendors" class="hidden">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h3 class="fw-bold">Vendor Management</h3>
                                <button class="btn btn-primary" onclick="addNewVendor()">
                                    <i class="fas fa-plus me-2"></i>Add Vendor
                                </button>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="table table-hover data-table">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Vendor ID</th>
                                            <th>Vendor Name</th>
                                            <th>Contact Person</th>
                                            <th>Email</th>
                                            <th>Phone</th>
                                            <th>Products</th>
                                            <th>Commission</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="vendorsTable">
                                        <!-- Vendors will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Analytics Section -->
                        <div id="adminAnalytics" class="hidden">
                            <h3 class="fw-bold mb-4">Analytics Dashboard</h3>
                            <div class="row mb-4">
                                <div class="col-md-8">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <h5 class="card-title fw-bold mb-0">Sales Performance</h5>
                                                <select class="form-select form-select-sm" style="width: 150px;" onchange="updateAnalyticsChart(this.value)">
                                                    <option value="daily">Daily</option>
                                                    <option value="weekly">Weekly</option>
                                                    <option value="monthly">Monthly</option>
                                                    <option value="yearly">Yearly</option>
                                                </select>
                                            </div>
                                            <canvas id="salesAnalyticsChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title fw-bold">Customer Insights</h5>
                                            <div class="mb-4">
                                                <h6>New Customers</h6>
                                                <div class="metric-value" id="newCustomersCount">0</div>
                                                <small class="text-success">+15% from last month</small>
                                            </div>
                                            <div class="mb-4">
                                                <h6>Repeat Purchase Rate</h6>
                                                <div class="metric-value" id="repeatPurchaseRate">0%</div>
                                                <div class="progress mt-2" style="height: 8px;">
                                                    <div class="progress-bar bg-success" id="repeatPurchaseBar" style="width: 0%"></div>
                                                </div>
                                            </div>
                                            <div>
                                                <h6>Average Order Value</h6>
                                                <div class="metric-value" id="averageOrderValue">0 UGX</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title fw-bold">Top Categories</h5>
                                            <canvas id="categoryAnalyticsChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title fw-bold">Geographic Distribution</h5>
                                            <div id="geographicData">
                                                <!-- Geographic data will be loaded here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Reports Section -->
                        <div id="adminReports" class="hidden">
                            <h3 class="fw-bold mb-4">Reports & Insights</h3>
                            <div class="row mb-4">
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title fw-bold">Sales Report</h5>
                                            <p class="card-text">Generate detailed sales reports for any time period.</p>
                                            <button class="btn btn-primary w-100" onclick="generateSalesReport()">
                                                <i class="fas fa-chart-line me-2"></i>Generate Sales Report
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title fw-bold">Inventory Report</h5>
                                            <p class="card-text">Get inventory status and stock movement reports.</p>
                                            <button class="btn btn-primary w-100" onclick="generateInventoryReport()">
                                                <i class="fas fa-boxes me-2"></i>Generate Inventory Report
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title fw-bold">Customer Report</h5>
                                            <p class="card-text">Analyze customer behavior and purchase patterns.</p>
                                            <button class="btn btn-primary w-100" onclick="generateCustomerReport()">
                                                <i class="fas fa-users me-2"></i>Generate Customer Report
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title fw-bold">Report Generator</h5>
                                    <form id="reportForm">
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Report Type</label>
                                                <select class="form-select" id="reportType" required>
                                                    <option value="">Select Report Type</option>
                                                    <option value="sales">Sales Report</option>
                                                    <option value="inventory">Inventory Report</option>
                                                    <option value="customer">Customer Report</option>
                                                    <option value="financial">Financial Report</option>
                                                    <option value="product">Product Performance</option>
                                                </select>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Date Range</label>
                                                <select class="form-select" id="reportDateRange" required>
                                                    <option value="today">Today</option>
                                                    <option value="yesterday">Yesterday</option>
                                                    <option value="this_week">This Week</option>
                                                    <option value="last_week">Last Week</option>
                                                    <option value="this_month">This Month</option>
                                                    <option value="last_month">Last Month</option>
                                                    <option value="custom">Custom Range</option>
                                                </select>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Format</label>
                                                <select class="form-select" id="reportFormat" required>
                                                    <option value="pdf">PDF</option>
                                                    <option value="excel">Excel</option>
                                                    <option value="csv">CSV</option>
                                                    <option value="html">HTML</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="row hidden" id="customDateRange">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Start Date</label>
                                                <input type="date" class="form-control" id="reportStartDate">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">End Date</label>
                                                <input type="date" class="form-control" id="reportEndDate">
                                            </div>
                                        </div>
                                        
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-download me-2"></i>Generate Report
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Promotions Section -->
                        <div id="adminPromotions" class="hidden">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h3 class="fw-bold">Promotions & Discounts</h3>
                                <button class="btn btn-primary" onclick="createNewPromotion()">
                                    <i class="fas fa-plus me-2"></i>Create Promotion
                                </button>
                            </div>
                            
                            <div class="row mb-4">
                                <div class="col-md-4">
                                    <div class="card bg-warning text-white">
                                        <div class="card-body">
                                            <h5 class="card-title">Active Promotions</h5>
                                            <div class="metric-value" id="activePromotionsCount">0</div>
                                            <p class="card-text">Currently running promotions</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card bg-success text-white">
                                        <div class="card-body">
                                            <h5 class="card-title">Total Discounts Given</h5>
                                            <div class="metric-value" id="totalDiscounts">0 UGX</div>
                                            <p class="card-text">Discounts applied to orders</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card bg-info text-white">
                                        <div class="card-body">
                                            <h5 class="card-title">Promotion Usage</h5>
                                            <div class="metric-value" id="promotionUsage">0</div>
                                            <p class="card-text">Times promotions were used</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover data-table">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>Promotion Code</th>
                                                    <th>Description</th>
                                                    <th>Discount</th>
                                                    <th>Start Date</th>
                                                    <th>End Date</th>
                                                    <th>Usage Limit</th>
                                                    <th>Used</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="promotionsTable">
                                                <!-- Promotions will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Settings Section -->
                        <div id="adminSettings" class="hidden">
                            <h3 class="fw-bold mb-4">Admin Settings</h3>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title fw-bold">Store Settings</h5>
                                            <form id="storeSettingsForm">
                                                <div class="mb-3">
                                                    <label class="form-label">Store Name</label>
                                                    <input type="text" class="form-control" id="storeName" value="UGX Marketplace" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Store Email</label>
                                                    <input type="email" class="form-control" id="storeEmail" value="support@ugxmarketplace.com" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Store Phone</label>
                                                    <input type="tel" class="form-control" id="storePhone" value="+256 700 123 456" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Default Currency</label>
                                                    <select class="form-select" id="storeCurrency" required>
                                                        <option value="UGX" selected>UGX - Ugandan Shilling</option>
                                                        <option value="USD">USD - US Dollar</option>
                                                        <option value="KES">KES - Kenyan Shilling</option>
                                                        <option value="TZS">TZS - Tanzanian Shilling</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Tax Rate (%)</label>
                                                    <input type="number" class="form-control" id="storeTaxRate" value="18" min="0" max="100" step="0.1" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Shipping Cost (UGX)</label>
                                                    <input type="number" class="form-control" id="storeShippingCost" value="10000" min="0" required>
                                                </div>
                                                <button type="submit" class="btn btn-primary">Save Store Settings</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title fw-bold">Notification Settings</h5>
                                            <form id="notificationSettingsForm">
                                                <div class="mb-3 form-check">
                                                    <input type="checkbox" class="form-check-input" id="newOrderNotification" checked>
                                                    <label class="form-check-label" for="newOrderNotification">New order notifications</label>
                                                </div>
                                                <div class="mb-3 form-check">
                                                    <input type="checkbox" class="form-check-input" id="lowStockNotification" checked>
                                                    <label class="form-check-label" for="lowStockNotification">Low stock alerts</label>
                                                </div>
                                                <div class="mb-3 form-check">
                                                    <input type="checkbox" class="form-check-input" id="newChatNotification" checked>
                                                    <label class="form-check-label" for="newChatNotification">New chat notifications</label>
                                                </div>
                                                <div class="mb-3 form-check">
                                                    <input type="checkbox" class="form-check-input" id="newCustomerNotification" checked>
                                                    <label class="form-check-label" for="newCustomerNotification">New customer registrations</label>
                                                </div>
                                                <div class="mb-3 form-check">
                                                    <input type="checkbox" class="form-check-input" id="reviewNotification">
                                                    <label class="form-check-label" for="reviewNotification">New product reviews</label>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Notification Email</label>
                                                    <input type="email" class="form-control" id="notificationEmail" value="admin@example.com" required>
                                                </div>
                                                <button type="submit" class="btn btn-primary">Save Notification Settings</button>
                                            </form>
                                        </div>
                                    </div>
                                    
                                    <div class="card mt-3">
                                        <div class="card-body">
                                            <h5 class="card-title fw-bold">System Maintenance</h5>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-outline-warning" onclick="clearCache()">
                                                    <i class="fas fa-broom me-2"></i>Clear Cache
                                                </button>
                                                <button class="btn btn-outline-info" onclick="backupDatabase()">
                                                    <i class="fas fa-database me-2"></i>Backup Database
                                                </button>
                                                <button class="btn btn-outline-danger" onclick="showSystemLogs()">
                                                    <i class="fas fa-file-alt me-2"></i>View System Logs
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Toast Container -->
        <div id="toastContainer" class="toast-container"></div>
    </div>

    <!-- Bootstrap 5 JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Enhanced Application State
        let appState = {
            currentUser: null,
            userType: null, // 'customer', 'admin', or 'vendor'
            products: [],
            orders: [],
            chats: [],
            customers: [],
            vendors: [],
            promotions: [],
            cart: [],
            notifications: [],
            currentChat: null,
            currentAdminChat: null,
            chatUpdateInterval: null,
            userAccounts: [
                { id: 1, email: 'customer@example.com', password: 'demo123', type: 'customer', name: 'John Customer' },
                { id: 2, email: 'admin@example.com', password: 'admin123', type: 'admin', name: 'Admin User' },
                { id: 3, email: 'vendor@example.com', password: 'vendor123', type: 'vendor', name: 'Vendor User' }
            ]
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Load sample data
            loadSampleData();
            
            // Set up event listeners
            document.getElementById('loginForm')?.addEventListener('submit', handleLogin);
            document.getElementById('uploadProductForm')?.addEventListener('submit', handleProductUpload);
            document.getElementById('storeSettingsForm')?.addEventListener('submit', handleStoreSettings);
            document.getElementById('notificationSettingsForm')?.addEventListener('submit', handleNotificationSettings);
            document.getElementById('reportForm')?.addEventListener('submit', handleReportGeneration);
            
            // Set up form validation
            setupFormValidation();
            
            // Report date range toggle
            const dateRangeSelect = document.getElementById('reportDateRange');
            if (dateRangeSelect) {
                dateRangeSelect.addEventListener('change', function() {
                    const customRangeDiv = document.getElementById('customDateRange');
                    if (this.value === 'custom') {
                        customRangeDiv.classList.remove('hidden');
                    } else {
                        customRangeDiv.classList.add('hidden');
                    }
                });
            }
        });

        // Login and Registration Functions
        function showRegistration() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('forgotPasswordForm').classList.add('hidden');
            document.getElementById('registrationForm').classList.remove('hidden');
            resetRegistrationForm();
        }

        function showLogin() {
            document.getElementById('registrationForm').classList.add('hidden');
            document.getElementById('forgotPasswordForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }

        function showForgotPassword() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registrationForm').classList.add('hidden');
            document.getElementById('forgotPasswordForm').classList.remove('hidden');
        }

        function resetRegistrationForm() {
            document.querySelectorAll('#registrationForm input, #registrationForm select').forEach(input => {
                if (input.type !== 'submit' && input.type !== 'button') {
                    input.value = '';
                }
            });
            document.getElementById('registrationStep1').classList.remove('hidden');
            document.getElementById('registrationStep2').classList.add('hidden');
            document.getElementById('registrationStep3').classList.add('hidden');
            
            // Reset steps
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById('step1').classList.add('active');
        }

        function nextRegistrationStep(step) {
            const step1 = document.getElementById('registrationStep1');
            const step2 = document.getElementById('registrationStep2');
            const step3 = document.getElementById('registrationStep3');
            
            if (step === 2) {
                // Validate step 1
                const email = document.getElementById('regEmail').value;
                const password = document.getElementById('regPassword').value;
                const confirmPassword = document.getElementById('regConfirmPassword').value;
                const accountType = document.getElementById('accountType').value;
                
                if (!email || !password || !confirmPassword || !accountType) {
                    showToast('Please fill in all required fields', 'warning');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showToast('Passwords do not match', 'warning');
                    return;
                }
                
                if (password.length < 6) {
                    showToast('Password must be at least 6 characters', 'warning');
                    return;
                }
                
                // Check if email already exists
                if (appState.userAccounts.find(user => user.email === email)) {
                    showToast('Email already registered. Please login instead.', 'warning');
                    return;
                }
                
                step1.classList.add('hidden');
                step2.classList.remove('hidden');
                
                // Update steps
                document.getElementById('step1').classList.remove('active');
                document.getElementById('step2').classList.add('active');
            } else if (step === 1) {
                step2.classList.add('hidden');
                step1.classList.remove('hidden');
                
                // Update steps
                document.getElementById('step2').classList.remove('active');
                document.getElementById('step1').classList.add('active');
            }
        }

        function completeRegistration() {
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const accountType = document.getElementById('accountType').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;
            const terms = document.getElementById('terms').checked;
            
            if (!firstName || !lastName || !terms) {
                showToast('Please fill in all required fields and accept the terms', 'warning');
                return;
            }
            
            // Create new user account
            const newUser = {
                id: appState.userAccounts.length + 1,
                email: email,
                password: password,
                type: accountType,
                name: `${firstName} ${lastName}`,
                phone: phone,
                address: address,
                joined: new Date().toISOString().split('T')[0]
            };
            
            appState.userAccounts.push(newUser);
            
            // Add to customers list if not admin
            if (accountType !== 'admin') {
                appState.customers.push({
                    id: newUser.id,
                    name: newUser.name,
                    email: newUser.email,
                    phone: newUser.phone,
                    address: newUser.address,
                    orders: 0,
                    totalSpent: 0,
                    joined: newUser.joined,
                    status: 'active'
                });
            }
            
            // Show success step
            document.getElementById('registrationStep2').classList.add('hidden');
            document.getElementById('registrationStep3').classList.remove('hidden');
            
            // Update steps
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step3').classList.add('active');
            
            showToast('Registration successful! You can now login.', 'success');
        }

        function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Clear previous errors
            clearValidationErrors();
            
            // Validate inputs
            if (!email || !password) {
                showToast('Please enter both email and password', 'warning');
                return;
            }
            
            // Find user
            const user = appState.userAccounts.find(u => u.email === email && u.password === password);
            
            if (!user) {
                showToast('Invalid email or password', 'error');
                return;
            }
            
            // Login successful
            appState.currentUser = user;
            appState.userType = user.type;
            
            // Set up user session
            initializeUserSession();
            
            showToast(`Welcome back, ${user.name}!`, 'success');
        }

        function initializeUserSession() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
            
            // Update UI based on user type
            document.getElementById('currentUser').textContent = appState.currentUser.name;
            document.getElementById('accountTypeBadge').textContent = appState.currentUser.type.charAt(0).toUpperCase() + appState.currentUser.type.slice(1);
            
            if (appState.userType === 'customer') {
                document.getElementById('customerInterface').classList.remove('hidden');
                document.getElementById('adminInterface').classList.add('hidden');
                document.getElementById('customerName').textContent = appState.currentUser.name;
                document.getElementById('customerEmail').textContent = appState.currentUser.email;
                document.getElementById('customerTypeBadge').textContent = 'Customer';
                
                // Load customer data
                loadProducts();
                loadCart();
                loadCustomerOrders();
                loadCustomerChats();
                loadNotifications();
                
            } else if (appState.userType === 'admin') {
                document.getElementById('adminInterface').classList.remove('hidden');
                document.getElementById('customerInterface').classList.add('hidden');
                
                // Load admin data
                loadAdminDashboard();
                loadAdminOrders();
                loadAdminProducts();
                loadAdminChats();
                loadCustomers();
                loadVendors();
                loadPromotions();
                loadNotifications();
            }
            
            // Start chat update interval
            startChatUpdateInterval();
            
            // Start notification update interval
            startNotificationUpdateInterval();
        }

        function logout() {
            appState.currentUser = null;
            appState.userType = null;
            appState.currentChat = null;
            appState.currentAdminChat = null;
            
            // Clear intervals
            if (appState.chatUpdateInterval) {
                clearInterval(appState.chatUpdateInterval);
                appState.chatUpdateInterval = null;
            }
            
            document.getElementById('appContainer').classList.add('hidden');
            document.getElementById('customerInterface').classList.add('hidden');
            document.getElementById('adminInterface').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            
            // Reset forms
            document.getElementById('loginForm').reset();
            resetRegistrationForm();
            
            showToast('Logged out successfully', 'success');
        }

        function sendResetLink() {
            const email = document.getElementById('resetEmail').value;
            
            if (!email) {
                showToast('Please enter your email address', 'warning');
                return;
            }
            
            // Simulate sending reset link
            showToast(`Password reset link sent to ${email}`, 'success');
            showLogin();
        }

        // Form Validation
        function setupFormValidation() {
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', function(e) {
                    if (!validateForm(this)) {
                        e.preventDefault();
                    }
                });
            });
        }

        function validateForm(form) {
            let isValid = true;
            const inputs = form.querySelectorAll('input[required], select[required], textarea[required]');
            
            inputs.forEach(input => {
                if (!input.value.trim()) {
                    isValid = false;
                    showInputError(input, 'This field is required');
                } else {
                    clearInputError(input);
                    
                    // Additional validation
                    if (input.type === 'email' && !isValidEmail(input.value)) {
                        isValid = false;
                        showInputError(input, 'Please enter a valid email address');
                    }
                    
                    if (input.type === 'password' && input.value.length < 6) {
                        isValid = false;
                        showInputError(input, 'Password must be at least 6 characters');
                    }
                    
                    if (input.type === 'tel' && !isValidPhone(input.value)) {
                        isValid = false;
                        showInputError(input, 'Please enter a valid phone number');
                    }
                }
            });
            
            return isValid;
        }

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function isValidPhone(phone) {
            return /^[\d\s\-\+\(\)]{10,}$/.test(phone);
        }

        function showInputError(input, message) {
            const errorDiv = input.nextElementSibling;
            if (errorDiv && errorDiv.classList.contains('validation-error')) {
                errorDiv.textContent = message;
            }
            input.classList.add('is-invalid');
        }

        function clearInputError(input) {
            const errorDiv = input.nextElementSibling;
            if (errorDiv && errorDiv.classList.contains('validation-error')) {
                errorDiv.textContent = '';
            }
            input.classList.remove('is-invalid');
            input.classList.add('is-valid');
        }

        function clearValidationErrors() {
            document.querySelectorAll('.is-invalid, .is-valid').forEach(el => {
                el.classList.remove('is-invalid', 'is-valid');
            });
            document.querySelectorAll('.validation-error').forEach(el => {
                el.textContent = '';
            });
        }

        // Enhanced Sample Data
        function loadSampleData() {
            // Enhanced products with more details
            appState.products = [
                {
                    id: 1,
                    name: "Smartphone X200",
                    description: "Latest smartphone with 128GB storage, 8GB RAM, dual camera system, and 6.5-inch OLED display",
                    price: 850000,
                    category: "electronics",
                    stock: 15,
                    minStock: 5,
                    image: "https://images.unsplash.com/photo-1598327105666-5b89351aff97?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8c21hcnRwaG9uZXxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=500&q=60",
                    brand: "TechMaster",
                    weight: 0.2,
                    dimensions: "1570.8",
                    vendorId: 1,
                    salesCount: 45,
                    rating: 4.5
                },
                {
                    id: 2,
                    name: "Men's Casual Shirt",
                    description: "Premium cotton casual shirt available in multiple colors, perfect for both casual and semi-formal occasions",
                    price: 45000,
                    category: "fashion",
                    stock: 42,
                    minStock: 10,
                    image: "https://images.unsplash.com/photo-1596755094514-f87e34085b2c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8c2hpcnR8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=500&q=60",
                    brand: "UrbanStyle",
                    weight: 0.3,
                    dimensions: "30405",
                    vendorId: 2,
                    salesCount: 28,
                    rating: 4.2
                },
                {
                    id: 3,
                    name: "Bluetooth Headphones",
                    description: "Wireless headphones with active noise cancellation, 30-hour battery life, and premium sound quality",
                    price: 120000,
                    category: "electronics",
                    stock: 8,
                    minStock: 5,
                    image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8aGVhZHBob25lc3xlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=500&q=60",
                    brand: "SoundPro",
                    weight: 0.25,
                    dimensions: "18158",
                    vendorId: 1,
                    salesCount: 32,
                    rating: 4.7
                },
                {
                    id: 4,
                    name: "Kitchen Blender",
                    description: "High-power blender with 1500W motor, 2L capacity, and multiple speed settings for smoothies and food processing",
                    price: 185000,
                    category: "home",
                    stock: 23,
                    minStock: 5,
                    image: "https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8YmxlbmRlcnxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=500&q=60",
                    brand: "BlendMaster",
                    weight: 3.5,
                    dimensions: "252040",
                    vendorId: 3,
                    salesCount: 19,
                    rating: 4.3
                },
                {
                    id: 5,
                    name: "Running Shoes",
                    description: "Professional running shoes with advanced cushion technology, breathable mesh, and durable rubber soles",
                    price: 150000,
                    category: "sports",
                    stock: 17,
                    minStock: 5,
                    image: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8c2hvZXN8ZW58MHx8MHx8fDA%3D%3D&auto=format&fit=crop&w=500&q=60",
                    brand: "RunFast",
                    weight: 0.8,
                    dimensions: "302010",
                    vendorId: 2,
                    salesCount: 41,
                    rating: 4.6
                },
                {
                    id: 6,
                    name: "Women's Handbag",
                    description: "Genuine leather handbag with multiple compartments, adjustable strap, and elegant design",
                    price: 95000,
                    category: "fashion",
                    stock: 11,
                    minStock: 5,
                    image: "https://images.unsplash.com/photo-1584917865442-de89df76afd3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8aGFuZGJhZ3xlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=500&q=60",
                    brand: "LeatherCraft",
                    weight: 0.5,
                    dimensions: "352515",
                    vendorId: 2,
                    salesCount: 23,
                    rating: 4.4
                }
            ];
            
            // Enhanced orders
            appState.orders = [
                {
                    id: 1001,
                    customerId: 1,
                    customerName: "John Customer",
                    customerEmail: "customer@example.com",
                    date: "2023-10-15",
                    items: [
                        { productId: 1, name: "Smartphone X200", quantity: 1, price: 850000 },
                        { productId: 3, name: "Bluetooth Headphones", quantity: 1, price: 120000 }
                    ],
                    total: 970000,
                    subtotal: 970000,
                    tax: 174600,
                    shipping: 10000,
                    finalTotal: 1154600,
                    status: "approved",
                    paymentMethod: "mobile_money",
                    paymentStatus: "paid",
                    shippingAddress: "123 Main Street, Kampala, Uganda",
                    trackingNumber: "TRK123456789"
                },
                {
                    id: 1002,
                    customerId: 1,
                    customerName: "John Customer",
                    customerEmail: "customer@example.com",
                    date: "2023-10-10",
                    items: [
                        { productId: 2, name: "Men's Casual Shirt", quantity: 2, price: 45000 },
                        { productId: 5, name: "Running Shoes", quantity: 1, price: 150000 }
                    ],
                    total: 240000,
                    subtotal: 240000,
                    tax: 43200,
                    shipping: 10000,
                    finalTotal: 293200,
                    status: "delivered",
                    paymentMethod: "credit_card",
                    paymentStatus: "paid",
                    shippingAddress: "123 Main Street, Kampala, Uganda",
                    trackingNumber: "TRK987654321"
                },
                {
                    id: 1003,
                    customerId: 2,
                    customerName: "Jane Buyer",
                    customerEmail: "jane@example.com",
                    date: "2023-10-18",
                    items: [
                        { productId: 4, name: "Kitchen Blender", quantity: 1, price: 185000 }
                    ],
                    total: 185000,
                    subtotal: 185000,
                    tax: 33300,
                    shipping: 10000,
                    finalTotal: 228300,
                    status: "pending",
                    paymentMethod: "cash_on_delivery",
                    paymentStatus: "pending",
                    shippingAddress: "456 Market Road, Entebbe, Uganda"
                }
            ];
            
            // Enhanced chats
            appState.chats = [
                {
                    id: 1,
                    productId: 1,
                    productName: "Smartphone X200",
                    customerId: 1,
                    customerName: "John Customer",
                    customerEmail: "customer@example.com",
                    messages: [
                        { id: 1, sender: "customer", text: "Hello, I'm interested in this smartphone. Is it available in blue color?", timestamp: getCurrentTimestamp(), read: true },
                        { id: 2, sender: "admin", text: "Yes, the blue color is available. We have it in stock.", timestamp: getCurrentTimestamp(), read: true }
                    ],
                    unread: false,
                    resolved: false,
                    lastUpdated: getCurrentTimestamp()
                }
            ];
            
            // Enhanced customers
            appState.customers = [
                { id: 1, name: "John Customer", email: "customer@example.com", phone: "+256 700 000 000", address: "123 Main Street, Kampala", orders: 5, totalSpent: 4500000, joined: "2023-08-10", status: "active" },
                { id: 2, name: "Jane Buyer", email: "jane@example.com", phone: "+256 700 111 111", address: "456 Market Road, Entebbe", orders: 3, totalSpent: 1200000, joined: "2023-09-15", status: "active" },
                { id: 3, name: "Robert Shopper", email: "robert@example.com", phone: "+256 700 222 222", address: "789 Business Avenue, Jinja", orders: 7, totalSpent: 3500000, joined: "2023-07-22", status: "active" },
                { id: 4, name: "Mary Consumer", email: "mary@example.com", phone: "+256 700 333 333", address: "101 Shopping Lane, Mbarara", orders: 2, totalSpent: 600000, joined: "2023-10-05", status: "inactive" }
            ];
            
            // Vendors
            appState.vendors = [
                { id: 1, name: "Tech Gadgets Ltd", contactPerson: "David Tech", email: "david@techgadgets.com", phone: "+256 700 444 444", products: 12, commission: 15, status: "active" },
                { id: 2, name: "Fashion World", contactPerson: "Sarah Style", email: "sarah@fashionworld.com", phone: "+256 700 555 555", products: 8, commission: 20, status: "active" },
                { id: 3, name: "Home Essentials", contactPerson: "Mike Home", email: "mike@homeessentials.com", phone: "+256 700 666 666", products: 5, commission: 18, status: "pending" }
            ];
            
            // Promotions
            appState.promotions = [
                { code: "WELCOME10", description: "Welcome discount for new customers", discount: 10, type: "percentage", startDate: "2023-01-01", endDate: "2023-12-31", usageLimit: 1000, used: 245, status: "active" },
                { code: "SUMMER25", description: "Summer sale discount", discount: 25, type: "percentage", startDate: "2023-06-01", endDate: "2023-08-31", usageLimit: 500, used: 189, status: "active" },
                { code: "FREESHIP", description: "Free shipping on orders over 200,000 UGX", discount: 0, type: "shipping", startDate: "2023-01-01", endDate: "2023-12-31", usageLimit: null, used: 342, status: "active" }
            ];
            
            // Notifications
            appState.notifications = [
                { id: 1, type: "order", title: "New Order Received", message: "Order #1004 from Robert Shopper", time: "2 minutes ago", read: false },
                { id: 2, type: "chat", title: "New Chat Message", message: "John Customer sent a new message", time: "15 minutes ago", read: false },
                { id: 3, type: "inventory", title: "Low Stock Alert", message: "Bluetooth Headphones stock is low", time: "1 hour ago", read: true }
            ];
        }

        function getCurrentTimestamp() {
            const now = new Date();
            return now.toLocaleString('en-US', { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            }).replace(/(\d+)\/(\d+)\/(\d+), (\d+:\d+)/, '$3-$1-$2 $4');
        }

        // Enhanced Product Functions
        function loadProducts() {
            const productGrid = document.getElementById('productGrid');
            if (!productGrid) return;
            
            productGrid.innerHTML = '';
            
            appState.products.forEach(product => {
                const productCard = createProductCard(product);
                productGrid.innerHTML += productCard;
            });
        }

        function createProductCard(product) {
            return `
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="position-relative">
                            <img src="${product.image}" class="card-img-top product-img" alt="${product.name}">
                            ${product.stock < product.minStock ? '<span class="position-absolute top-0 start-0 badge bg-danger m-2">Low Stock</span>' : ''}
                            ${product.salesCount > 30 ? '<span class="position-absolute top-0 end-0 badge bg-success m-2">Popular</span>' : ''}
                            <div class="product-actions position-absolute bottom-0 end-0 m-2">
                                <button class="btn btn-sm btn-primary" onclick="addToCart(${product.id})" title="Add to Cart">
                                    <i class="fas fa-cart-plus"></i>
                                </button>
                                <button class="btn btn-sm btn-info" onclick="viewProductDetails(${product.id})" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">${product.name}</h5>
                            <p class="card-text text-muted small">${product.description.substring(0, 100)}...</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h4 class="text-primary fw-bold">${formatCurrency(product.price)} UGX</h4>
                                    <div class="d-flex align-items-center">
                                        <span class="badge ${product.stock > 10 ? 'bg-success' : 'bg-warning'} me-2">
                                            ${product.stock} in stock
                                        </span>
                                        <small class="text-muted">
                                            <i class="fas fa-star text-warning"></i> ${product.rating}
                                        </small>
                                    </div>
                                </div>
                                <button class="btn btn-success" onclick="startProductChat(${product.id})">
                                    <i class="fas fa-comment me-1"></i> Chat
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function viewProductDetails(productId) {
            const product = appState.products.find(p => p.id === productId);
            if (!product) return;
            
            const modalHtml = `
                <div class="modal fade" id="productDetailsModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">${product.name}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <img src="${product.image}" class="img-fluid rounded" alt="${product.name}">
                                    </div>
                                    <div class="col-md-6">
                                        <h4 class="fw-bold text-primary">${formatCurrency(product.price)} UGX</h4>
                                        <p class="text-muted">${product.description}</p>
                                        <div class="mb-3">
                                            <strong>Brand:</strong> ${product.brand}<br>
                                            <strong>Category:</strong> ${product.category}<br>
                                            <strong>Weight:</strong> ${product.weight} kg<br>
                                            <strong>Dimensions:</strong> ${product.dimensions} cm
                                        </div>
                                        <div class="mb-3">
                                            <strong>Stock Status:</strong>
                                            <span class="badge ${product.stock > 10 ? 'bg-success' : product.stock > 0 ? 'bg-warning' : 'bg-danger'}">
                                                ${product.stock > 0 ? `${product.stock} items available` : 'Out of Stock'}
                                            </span>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-primary flex-fill" onclick="addToCart(${product.id})">
                                                <i class="fas fa-cart-plus me-2"></i>Add to Cart
                                            </button>
                                            <button class="btn btn-outline-primary" onclick="startProductChat(${product.id})">
                                                <i class="fas fa-comment me-2"></i>Ask Question
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal if any
            const existingModal = document.getElementById('productDetailsModal');
            if (existingModal) existingModal.remove();
            
            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('productDetailsModal'));
            modal.show();
        }

        function filterProducts(criteria) {
            const productGrid = document.getElementById('productGrid');
            if (!productGrid) return;
            
            productGrid.innerHTML = '';
            
            let filteredProducts = [...appState.products];
            
            if (criteria === 'all') {
                // Show all products
            } else if (['electronics', 'fashion', 'home', 'sports'].includes(criteria)) {
                filteredProducts = filteredProducts.filter(p => p.category === criteria);
            } else if (criteria === 'price-low-high') {
                filteredProducts.sort((a, b) => a.price - b.price);
            } else if (criteria === 'price-high-low') {
                filteredProducts.sort((a, b) => b.price - a.price);
            }
            
            filteredProducts.forEach(product => {
                const productCard = createProductCard(product);
                productGrid.innerHTML += productCard;
            });
        }

        function searchProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const productGrid = document.getElementById('productGrid');
            if (!productGrid) return;
            
            productGrid.innerHTML = '';
            
            let filteredProducts = appState.products.filter(p => 
                p.name.toLowerCase().includes(searchTerm) || 
                p.description.toLowerCase().includes(searchTerm) ||
                p.brand.toLowerCase().includes(searchTerm)
            );
            
            if (filteredProducts.length === 0) {
                productGrid.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h5>No products found</h5>
                        <p class="text-muted">Try a different search term</p>
                    </div>
                `;
                return;
            }
            
            filteredProducts.forEach(product => {
                const productCard = createProductCard(product);
                productGrid.innerHTML += productCard;
            });
        }

        // Cart Functions
        function loadCart() {
            const cartContent = document.getElementById('cartContent');
            const cartCount = document.getElementById('cartCount');
            const clearCartBtn = document.getElementById('clearCartBtn');
            const checkoutBtn = document.getElementById('checkoutBtn');
            
            if (!cartContent) return;
            
            if (appState.cart.length === 0) {
                cartContent.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
                        <h5>Your cart is empty</h5>
                        <p class="text-muted">Add some products from the store</p>
                        <button class="btn btn-primary" onclick="document.getElementById('store-tab').click()">
                            <i class="fas fa-store me-2"></i>Go Shopping
                        </button>
                    </div>
                `;
                cartCount.textContent = '0';
                clearCartBtn.disabled = true;
                checkoutBtn.disabled = true;
                return;
            }
            
            cartContent.innerHTML = `
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Total</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="cartItems">
                            ${appState.cart.map((item, index) => `
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <img src="${item.image}" class="rounded me-3" style="width: 60px; height: 60px; object-fit: cover;">
                                            <div>
                                                <h6 class="mb-0">${item.name}</h6>
                                                <small class="text-muted">${item.brand}</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>${formatCurrency(item.price)} UGX</td>
                                    <td>
                                        <div class="input-group input-group-sm" style="width: 120px;">
                                            <button class="btn btn-outline-secondary" type="button" onclick="updateCartQuantity(${index}, -1)">-</button>
                                            <input type="number" class="form-control text-center" value="1" min="1" max="${item.stock}" onchange="updateCartQuantityInput(${index}, this.value)">
                                            <button class="btn btn-outline-secondary" type="button" onclick="updateCartQuantity(${index}, 1)">+</button>
                                        </div>
                                    </td>
                                    <td>${formatCurrency(item.price)} UGX</td>
                                    <td>
                                        <button class="btn btn-sm btn-danger" onclick="removeFromCart(${index})">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            cartCount.textContent = appState.cart.length;
            clearCartBtn.disabled = false;
            checkoutBtn.disabled = false;
            
            updateCartSummary();
        }

        function addToCart(productId) {
            const product = appState.products.find(p => p.id === productId);
            if (!product) {
                showToast('Product not found', 'error');
                return;
            }
            
            if (product.stock < 1) {
                showToast('Product is out of stock', 'warning');
                return;
            }
            
            appState.cart.push({...product, quantity: 1});
            loadCart();
            showToast(`${product.name} added to cart`, 'success');
            
            // Update cart count in navbar
            updateCartCount();
        }

        function removeFromCart(index) {
            const product = appState.cart[index];
            appState.cart.splice(index, 1);
            loadCart();
            showToast(`${product.name} removed from cart`, 'info');
            updateCartCount();
        }

        function updateCartQuantity(index, change) {
            if (appState.cart[index]) {
                const newQuantity = (appState.cart[index].quantity || 1) + change;
                if (newQuantity < 1) {
                    removeFromCart(index);
                } else if (newQuantity > appState.cart[index].stock) {
                    showToast(`Only ${appState.cart[index].stock} items available`, 'warning');
                } else {
                    appState.cart[index].quantity = newQuantity;
                    loadCart();
                }
            }
        }

        function updateCartQuantityInput(index, value) {
            const quantity = parseInt(value) || 1;
            if (quantity < 1) {
                removeFromCart(index);
            } else if (quantity > appState.cart[index].stock) {
                showToast(`Only ${appState.cart[index].stock} items available`, 'warning');
                appState.cart[index].quantity = appState.cart[index].stock;
                loadCart();
            } else {
                appState.cart[index].quantity = quantity;
                loadCart();
            }
        }

        function clearCart() {
            if (appState.cart.length === 0) return;
            
            if (confirm('Are you sure you want to clear your cart?')) {
                appState.cart = [];
                loadCart();
                showToast('Cart cleared', 'info');
                updateCartCount();
            }
        }

        function updateCartSummary() {
            const subtotal = appState.cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);
            const tax = subtotal * 0.18;
            const shipping = 10000;
            const total = subtotal + tax + shipping;
            
            document.getElementById('cartSubtotal').textContent = formatCurrency(subtotal) + ' UGX';
            document.getElementById('cartTax').textContent = formatCurrency(tax) + ' UGX';
            document.getElementById('cartTotal').textContent = formatCurrency(total) + ' UGX';
        }

        function updateCartCount() {
            const cartCount = document.getElementById('cartCount');
            if (cartCount) {
                cartCount.textContent = appState.cart.length;
                cartCount.style.display = appState.cart.length > 0 ? 'inline' : 'none';
            }
        }

        function processOrder() {
            if (appState.cart.length === 0) {
                showToast('Your cart is empty', 'warning');
                return;
            }
            
            const shippingAddress = document.getElementById('shippingAddress').value;
            const paymentMethod = document.getElementById('paymentMethod').value;
            
            if (!shippingAddress) {
                showToast('Please enter shipping address', 'warning');
                return;
            }
            
            // Calculate order totals
            const subtotal = appState.cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);
            const tax = subtotal * 0.18;
            const shipping = 10000;
            const total = subtotal + tax + shipping;
            
            // Create new order
            const newOrderId = appState.orders.length + 1001;
            const newOrder = {
                id: newOrderId,
                customerId: appState.currentUser.id,
                customerName: appState.currentUser.name,
                customerEmail: appState.currentUser.email,
                date: new Date().toISOString().split('T')[0],
                items: appState.cart.map(item => ({
                    productId: item.id,
                    name: item.name,
                    quantity: item.quantity || 1,
                    price: item.price
                })),
                total: subtotal,
                subtotal: subtotal,
                tax: tax,
                shipping: shipping,
                finalTotal: total,
                status: "pending",
                paymentMethod: paymentMethod,
                paymentStatus: paymentMethod === 'cash_on_delivery' ? 'pending' : 'paid',
                shippingAddress: shippingAddress
            };
            
            appState.orders.push(newOrder);
            
            // Update product stock
            appState.cart.forEach(item => {
                const product = appState.products.find(p => p.id === item.id);
                if (product) {
                    product.stock -= (item.quantity || 1);
                }
            });
            
            // Clear cart
            appState.cart = [];
            loadCart();
            
            // Show success message
            showToast(`Order #${newOrderId} placed successfully!`, 'success');
            
            // Add notification for admin
            appState.notifications.push({
                id: appState.notifications.length + 1,
                type: "order",
                title: "New Order Received",
                message: `Order #${newOrderId} from ${appState.currentUser.name}`,
                time: "Just now",
                read: false
            });
            
            // Update admin dashboard if admin is logged in
            if (appState.userType === 'admin') {
                loadAdminDashboard();
            }
            
            // Switch to orders tab
            document.getElementById('orders-tab').click();
        }

        // Enhanced Admin Functions
        function showAdminSection(section) {
            // Hide all sections
            const sections = ['adminDashboard', 'adminOrders', 'adminProducts', 'adminInventory', 
                            'adminUpload', 'adminChats', 'adminCustomers', 'adminVendors', 
                            'adminAnalytics', 'adminReports', 'adminPromotions', 'adminSettings'];
            sections.forEach(sec => {
                const el = document.getElementById(sec);
                if (el) el.classList.add('hidden');
            });
            
            // Remove active class from all nav links
            document.querySelectorAll('#adminNav .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected section
            const targetId = `admin${section.charAt(0).toUpperCase() + section.slice(1)}`;
            const targetEl = document.getElementById(targetId);
            if (targetEl) {
                targetEl.classList.remove('hidden');
            }
            
            // Activate nav link
            const navLink = document.querySelector(`#adminNav a[onclick*="${section}"]`);
            if (navLink) navLink.classList.add('active');
            
            // Load section data
            switch(section) {
                case 'dashboard':
                    loadAdminDashboard();
                    break;
                case 'orders':
                    loadAdminOrders();
                    break;
                case 'products':
                    loadAdminProducts();
                    break;
                case 'inventory':
                    loadInventory();
                    break;
                case 'chats':
                    loadAdminChats();
                    break;
                case 'customers':
                    loadCustomers();
                    break;
                case 'vendors':
                    loadVendors();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
                case 'promotions':
                    loadPromotions();
                    break;
            }
        }

        function loadAdminDashboard() {
            // Update stats
            document.getElementById('totalOrders').textContent = appState.orders.length;
            
            const totalRevenue = appState.orders.reduce((sum, order) => sum + order.finalTotal, 0);
            document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue) + ' UGX';
            
            document.getElementById('totalProducts').textContent = appState.products.length;
            
            const activeChats = appState.chats.filter(chat => !chat.resolved).length;
            document.getElementById('activeChats').textContent = activeChats;
            
            // Update recent orders
            const recentOrdersTable = document.getElementById('recentOrdersTable');
            if (recentOrdersTable) {
                recentOrdersTable.innerHTML = '';
                
                const recentOrders = [...appState.orders]
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 5);
                
                recentOrders.forEach(order => {
                    const statusBadge = getStatusBadge(order.status);
                    
                    const row = `
                        <tr>
                            <td>#${order.id}</td>
                            <td>${order.customerName}</td>
                            <td>${formatCurrency(order.finalTotal)} UGX</td>
                            <td>${statusBadge}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="viewAdminOrder(${order.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                    recentOrdersTable.innerHTML += row;
                });
            }
            
            // Update top products
            const topProductsList = document.getElementById('topProductsList');
            if (topProductsList) {
                topProductsList.innerHTML = '';
                
                const topProducts = [...appState.products]
                    .sort((a, b) => b.salesCount - a.salesCount)
                    .slice(0, 5);
                
                topProducts.forEach(product => {
                    const item = `
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">${product.name}</h6>
                                <small class="text-muted">${formatCurrency(product.price)} UGX</small>
                            </div>
                            <span class="badge bg-primary rounded-pill">${product.salesCount} sold</span>
                        </div>
                    `;
                    topProductsList.innerHTML += item;
                });
            }
            
            // Update system alerts
            const systemAlerts = document.getElementById('systemAlerts');
            if (systemAlerts) {
                systemAlerts.innerHTML = '';
                
                const lowStockProducts = appState.products.filter(p => p.stock < p.minStock);
                const pendingOrders = appState.orders.filter(o => o.status === 'pending').length;
                const unresolvedChats = appState.chats.filter(c => !c.resolved).length;
                
                if (lowStockProducts.length > 0) {
                    systemAlerts.innerHTML += `
                        <div class="alert alert-warning d-flex align-items-center mb-2">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <div>
                                <strong>Low Stock Alert:</strong> ${lowStockProducts.length} products need restocking
                                <a href="#" class="alert-link ms-2" onclick="showAdminSection('inventory')">View</a>
                            </div>
                        </div>
                    `;
                }
                
                if (pendingOrders > 0) {
                    systemAlerts.innerHTML += `
                        <div class="alert alert-info d-flex align-items-center mb-2">
                            <i class="fas fa-shopping-cart me-2"></i>
                            <div>
                                <strong>Pending Orders:</strong> ${pendingOrders} orders require processing
                                <a href="#" class="alert-link ms-2" onclick="showAdminSection('orders')">View</a>
                            </div>
                        </div>
                    `;
                }
                
                if (unresolvedChats > 0) {
                    systemAlerts.innerHTML += `
                        <div class="alert alert-danger d-flex align-items-center mb-2">
                            <i class="fas fa-comments me-2"></i>
                            <div>
                                <strong>Unresolved Chats:</strong> ${unresolvedChats} customer chats need response
                                <a href="#" class="alert-link ms-2" onclick="showAdminSection('chats')">View</a>
                            </div>
                        </div>
                    `;
                }
                
                if (systemAlerts.innerHTML === '') {
                    systemAlerts.innerHTML = `
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>
                            All systems are running smoothly
                        </div>
                    `;
                }
            }
            
            // Update charts
            updateDashboardCharts();
        }

        function updateDashboardCharts() {
            // Sales chart
            const salesCtx = document.getElementById('salesChart');
            if (salesCtx) {
                const salesData = {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Revenue (UGX)',
                        data: [450000, 520000, 480000, 610000, 730000, 820000, 690000],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                };
                
                if (window.salesChart) {
                    window.salesChart.destroy();
                }
                
                window.salesChart = new Chart(salesCtx.getContext('2d'), {
                    type: 'line',
                    data: salesData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                ticks: {
                                    callback: function(value) {
                                        return 'UGX ' + (value / 1000).toFixed(0) + 'K';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        function loadInventory() {
            const inventoryTable = document.getElementById('inventoryTable');
            const lowStockAlertCount = document.getElementById('lowStockAlertCount');
            const lowStockCount = document.getElementById('lowStockCount');
            
            if (!inventoryTable) return;
            
            inventoryTable.innerHTML = '';
            
            const lowStockItems = appState.products.filter(p => p.stock < p.minStock);
            
            // Update low stock counts
            if (lowStockAlertCount) {
                lowStockAlertCount.textContent = `${lowStockItems.length} products`;
            }
            if (lowStockCount) {
                lowStockCount.textContent = lowStockItems.length;
                lowStockCount.style.display = lowStockItems.length > 0 ? 'inline' : 'none';
            }
            
            appState.products.forEach(product => {
                const status = product.stock === 0 ? 'Out of Stock' :
                             product.stock < product.minStock ? 'Low Stock' : 'In Stock';
                const statusClass = product.stock === 0 ? 'danger' :
                                  product.stock < product.minStock ? 'warning' : 'success';
                
                const row = `
                    <tr>
                        <td>${product.id}</td>
                        <td>${product.name}</td>
                        <td>${product.category}</td>
                        <td>${product.stock}</td>
                        <td>${product.minStock}</td>
                        <td><span class="badge bg-${statusClass}">${status}</span></td>
                        <td>${new Date().toLocaleDateString()}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="updateStock(${product.id})">
                                <i class="fas fa-edit"></i> Update
                            </button>
                        </td>
                    </tr>
                `;
                inventoryTable.innerHTML += row;
            });
        }

        function updateStock(productId) {
            const product = appState.products.find(p => p.id === productId);
            if (!product) return;
            
            const newStock = prompt(`Enter new stock quantity for ${product.name}:`, product.stock);
            if (newStock !== null && !isNaN(newStock) && newStock >= 0) {
                product.stock = parseInt(newStock);
                loadInventory();
                loadAdminDashboard();
                showToast(`Stock updated for ${product.name}`, 'success');
            }
        }

        function showBulkStockUpdate() {
            const modalHtml = `
                <div class="modal fade" id="bulkStockModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Bulk Stock Update</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <p class="mb-3">Upload a CSV file with product IDs and new stock quantities:</p>
                                <div class="mb-3">
                                    <input type="file" class="form-control" id="stockUpdateFile" accept=".csv">
                                </div>
                                <div class="alert alert-info">
                                    <small>
                                        <strong>CSV Format:</strong> product_id,new_stock<br>
                                        Example:<br>
                                        1,50<br>
                                        2,30<br>
                                        3,20
                                    </small>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" onclick="processBulkStockUpdate()">Update Stock</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal if any
            const existingModal = document.getElementById('bulkStockModal');
            if (existingModal) existingModal.remove();
            
            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('bulkStockModal'));
            modal.show();
        }

        function loadVendors() {
            const vendorsTable = document.getElementById('vendorsTable');
            if (!vendorsTable) return;
            
            vendorsTable.innerHTML = '';
            
            appState.vendors.forEach(vendor => {
                const statusBadge = vendor.status === 'active' ? 
                    '<span class="badge bg-success">Active</span>' :
                    '<span class="badge bg-warning">Pending</span>';
                
                const row = `
                    <tr>
                        <td>${vendor.id}</td>
                        <td>${vendor.name}</td>
                        <td>${vendor.contactPerson}</td>
                        <td>${vendor.email}</td>
                        <td>${vendor.phone}</td>
                        <td>${vendor.products}</td>
                        <td>${vendor.commission}%</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="editVendor(${vendor.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteVendor(${vendor.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                vendorsTable.innerHTML += row;
            });
        }

        function loadPromotions() {
            const promotionsTable = document.getElementById('promotionsTable');
            const activePromotionsCount = document.getElementById('activePromotionsCount');
            const totalDiscounts = document.getElementById('totalDiscounts');
            const promotionUsage = document.getElementById('promotionUsage');
            
            if (!promotionsTable) return;
            
            promotionsTable.innerHTML = '';
            
            // Update promotion stats
            if (activePromotionsCount) {
                const activeCount = appState.promotions.filter(p => p.status === 'active').length;
                activePromotionsCount.textContent = activeCount;
            }
            
            if (totalDiscounts) {
                // Calculate total discounts (simplified)
                const total = appState.promotions.reduce((sum, promo) => sum + (promo.used * 10000), 0);
                totalDiscounts.textContent = formatCurrency(total) + ' UGX';
            }
            
            if (promotionUsage) {
                const totalUsage = appState.promotions.reduce((sum, promo) => sum + promo.used, 0);
                promotionUsage.textContent = totalUsage;
            }
            
            appState.promotions.forEach(promo => {
                const statusBadge = promo.status === 'active' ? 
                    '<span class="badge bg-success">Active</span>' :
                    '<span class="badge bg-secondary">Inactive</span>';
                
                const discountText = promo.type === 'shipping' ? 
                    'Free Shipping' : 
                    `${promo.discount}% ${promo.type === 'percentage' ? 'Off' : ''}`;
                
                const row = `
                    <tr>
                        <td><strong>${promo.code}</strong></td>
                        <td>${promo.description}</td>
                        <td>${discountText}</td>
                        <td>${promo.startDate}</td>
                        <td>${promo.endDate}</td>
                        <td>${promo.usageLimit || 'Unlimited'}</td>
                        <td>${promo.used}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="editPromotion('${promo.code}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deletePromotion('${promo.code}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                promotionsTable.innerHTML += row;
            });
        }

        function createNewPromotion() {
            const modalHtml = `
                <div class="modal fade" id="newPromotionModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Create New Promotion</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="promotionForm">
                                    <div class="mb-3">
                                        <label class="form-label">Promotion Code</label>
                                        <input type="text" class="form-control" id="promoCode" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Description</label>
                                        <input type="text" class="form-control" id="promoDescription" required>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Discount Type</label>
                                            <select class="form-select" id="promoType" required>
                                                <option value="percentage">Percentage</option>
                                                <option value="fixed">Fixed Amount</option>
                                                <option value="shipping">Free Shipping</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Discount Value</label>
                                            <input type="number" class="form-control" id="promoDiscount" min="0" required>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Start Date</label>
                                            <input type="date" class="form-control" id="promoStartDate" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">End Date</label>
                                            <input type="date" class="form-control" id="promoEndDate" required>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Usage Limit (leave empty for unlimited)</label>
                                        <input type="number" class="form-control" id="promoUsageLimit" min="1">
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" onclick="savePromotion()">Save Promotion</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal if any
            const existingModal = document.getElementById('newPromotionModal');
            if (existingModal) existingModal.remove();
            
            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Set default dates
            const startDate = new Date();
            const endDate = new Date();
            endDate.setMonth(endDate.getMonth() + 1);
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('newPromotionModal'));
            modal.show();
            
            // Set default dates in form
            setTimeout(() => {
                document.getElementById('promoStartDate').value = startDate.toISOString().split('T')[0];
                document.getElementById('promoEndDate').value = endDate.toISOString().split('T')[0];
            }, 100);
        }

        function savePromotion() {
            const code = document.getElementById('promoCode').value;
            const description = document.getElementById('promoDescription').value;
            const type = document.getElementById('promoType').value;
            const discount = parseFloat(document.getElementById('promoDiscount').value);
            const startDate = document.getElementById('promoStartDate').value;
            const endDate = document.getElementById('promoEndDate').value;
            const usageLimit = document.getElementById('promoUsageLimit').value;
            
            if (!code || !description || !type || isNaN(discount) || !startDate || !endDate) {
                showToast('Please fill in all required fields', 'warning');
                return;
            }
            
            // Check if code already exists
            if (appState.promotions.find(p => p.code === code)) {
                showToast('Promotion code already exists', 'warning');
                return;
            }
            
            const newPromotion = {
                code: code,
                description: description,
                discount: discount,
                type: type,
                startDate: startDate,
                endDate: endDate,
                usageLimit: usageLimit ? parseInt(usageLimit) : null,
                used: 0,
                status: 'active'
            };
            
            appState.promotions.push(newPromotion);
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('newPromotionModal'));
            modal.hide();
            
            // Refresh promotions list
            loadPromotions();
            
            showToast('Promotion created successfully', 'success');
        }

        function deletePromotion(code) {
            if (confirm(`Are you sure you want to delete promotion ${code}?`)) {
                const index = appState.promotions.findIndex(p => p.code === code);
                if (index > -1) {
                    appState.promotions.splice(index, 1);
                    loadPromotions();
                    showToast('Promotion deleted', 'success');
                }
            }
        }

        // Settings Functions
        function handleStoreSettings(e) {
            e.preventDefault();
            // In a real app, this would save to a backend
            showToast('Store settings saved successfully', 'success');
        }

        function handleNotificationSettings(e) {
            e.preventDefault();
            // In a real app, this would save to a backend
            showToast('Notification settings saved successfully', 'success');
        }

        function handleReportGeneration(e) {
            e.preventDefault();
            
            const reportType = document.getElementById('reportType').value;
            const dateRange = document.getElementById('reportDateRange').value;
            const format = document.getElementById('reportFormat').value;
            
            if (!reportType) {
                showToast('Please select a report type', 'warning');
                return;
            }
            
            // Simulate report generation
            showToast(`Generating ${reportType} report...`, 'info');
            
            setTimeout(() => {
                showToast(`${reportType} report generated successfully! Download will start shortly.`, 'success');
                
                // Simulate download
                const link = document.createElement('a');
                link.download = `${reportType}_report_${new Date().toISOString().split('T')[0]}.${format}`;
                link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(`Report generated on ${new Date().toLocaleString()}`);
                link.click();
            }, 2000);
        }

        function clearCache() {
            if (confirm('Are you sure you want to clear the cache?')) {
                showToast('Cache cleared successfully', 'success');
            }
        }

        function backupDatabase() {
            showToast('Creating database backup...', 'info');
            
            setTimeout(() => {
                showToast('Database backup completed successfully', 'success');
                
                // Simulate download
                const link = document.createElement('a');
                link.download = `database_backup_${new Date().toISOString().split('T')[0]}.sql`;
                link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent('-- Database backup would be here in a real application --');
                link.click();
            }, 1500);
        }

        function showSystemLogs() {
            const modalHtml = `
                <div class="modal fade" id="systemLogsModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">System Logs</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>Timestamp</th>
                                                <th>Level</th>
                                                <th>Message</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>${new Date().toLocaleString()}</td>
                                                <td><span class="badge bg-success">INFO</span></td>
                                                <td>System started successfully</td>
                                            </tr>
                                            <tr>
                                                <td>${new Date(Date.now() - 3600000).toLocaleString()}</td>
                                                <td><span class="badge bg-info">DEBUG</span></td>
                                                <td>User session created</td>
                                            </tr>
                                            <tr>
                                                <td>${new Date(Date.now() - 7200000).toLocaleString()}</td>
                                                <td><span class="badge bg-warning">WARN</span></td>
                                                <td>Low stock alert triggered</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" onclick="exportLogs()">
                                    <i class="fas fa-download me-2"></i>Export Logs
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal if any
            const existingModal = document.getElementById('systemLogsModal');
            if (existingModal) existingModal.remove();
            
            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('systemLogsModal'));
            modal.show();
        }

        // Notification Functions
        function loadNotifications() {
            const notificationList = document.getElementById('notificationList');
            const notificationCount = document.getElementById('notificationCount');
            
            if (!notificationList) return;
            
            notificationList.innerHTML = '';
            
            const unreadCount = appState.notifications.filter(n => !n.read).length;
            
            if (notificationCount) {
                notificationCount.textContent = unreadCount;
                notificationCount.style.display = unreadCount > 0 ? 'inline' : 'none';
            }
            
            if (appState.notifications.length === 0) {
                notificationList.innerHTML = `
                    <div class="text-center py-3">
                        <i class="fas fa-bell-slash text-muted fa-2x mb-2"></i>
                        <p class="text-muted mb-0">No notifications</p>
                    </div>
                `;
                return;
            }
            
            appState.notifications.slice(0, 5).forEach(notification => {
                const notificationClass = notification.read ? '' : 'fw-bold';
                const notificationItem = `
                    <a href="#" class="dropdown-item ${notificationClass}" onclick="handleNotificationClick(${notification.id})">
                        <div class="d-flex w-100">
                            <div class="me-3">
                                <i class="fas fa-${getNotificationIcon(notification.type)} text-${getNotificationColor(notification.type)}"></i>
                            </div>
                            <div>
                                <h6 class="mb-1">${notification.title}</h6>
                                <p class="mb-0 text-muted small">${notification.message}</p>
                                <small class="text-muted">${notification.time}</small>
                            </div>
                        </div>
                    </a>
                    <div class="dropdown-divider"></div>
                `;
                notificationList.innerHTML += notificationItem;
            });
        }

        function getNotificationIcon(type) {
            switch(type) {
                case 'order': return 'shopping-cart';
                case 'chat': return 'comments';
                case 'inventory': return 'box';
                default: return 'bell';
            }
        }

        function getNotificationColor(type) {
            switch(type) {
                case 'order': return 'primary';
                case 'chat': return 'success';
                case 'inventory': return 'warning';
                default: return 'info';
            }
        }

        function handleNotificationClick(notificationId) {
            const notification = appState.notifications.find(n => n.id === notificationId);
            if (notification) {
                notification.read = true;
                loadNotifications();
                
                // Handle notification action
                switch(notification.type) {
                    case 'order':
                        showAdminSection('orders');
                        break;
                    case 'chat':
                        showAdminSection('chats');
                        break;
                    case 'inventory':
                        showAdminSection('inventory');
                        break;
                }
            }
        }

        function markAllAsRead() {
            appState.notifications.forEach(n => n.read = true);
            loadNotifications();
            showToast('All notifications marked as read', 'success');
        }

        function startNotificationUpdateInterval() {
            setInterval(() => {
                loadNotifications();
            }, 30000); // Update every 30 seconds
        }

        // Enhanced Chat Functions
        function startChatUpdateInterval() {
            // Clear existing interval
            if (appState.chatUpdateInterval) {
                clearInterval(appState.chatUpdateInterval);
            }
            
            // Start new interval to check for new messages
            appState.chatUpdateInterval = setInterval(() => {
                if (appState.userType === 'customer') {
                    loadCustomerChats();
                    if (appState.currentChat) {
                        updateCurrentChatIfOpen(appState.currentChat.id);
                    }
                } else if (appState.userType === 'admin') {
                    loadAdminChats();
                    if (appState.currentAdminChat) {
                        updateCurrentAdminChatIfOpen(appState.currentAdminChat.id);
                    }
                }
            }, 3000); // Check every 3 seconds
        }

        function exportChat() {
            if (!appState.currentAdminChat) {
                showToast('No chat selected', 'warning');
                return;
            }
            
            const chat = appState.currentAdminChat;
            let chatContent = `Chat Export - ${chat.productName}\n`;
            chatContent += `Customer: ${chat.customerName}\n`;
            chatContent += `Date: ${new Date().toLocaleString()}\n\n`;
            chatContent += 'Messages:\n\n';
            
            chat.messages.forEach(msg => {
                const sender = msg.sender === 'customer' ? chat.customerName : 'Admin';
                chatContent += `${sender} (${msg.timestamp}): ${msg.text}\n`;
            });
            
            // Create download link
            const link = document.createElement('a');
            link.download = `chat_${chat.id}_${new Date().toISOString().split('T')[0]}.txt`;
            link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(chatContent);
            link.click();
            
            showToast('Chat exported successfully', 'success');
        }

        // Utility Functions
        function formatCurrency(amount) {
            return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function getStatusBadge(status) {
            const badges = {
                'pending': '<span class="badge badge-pending">Pending</span>',
                'processing': '<span class="badge badge-processing">Processing</span>',
                'shipped': '<span class="badge badge-shipped">Shipped</span>',
                'delivered': '<span class="badge badge-delivered">Delivered</span>',
                'cancelled': '<span class="badge badge-cancelled">Cancelled</span>'
            };
            return badges[status] || '<span class="badge bg-secondary">' + status + '</span>';
        }

        function showToast(message, type = 'info') {
            // Create toast container if it doesn't exist
            let toastContainer = document.getElementById('toastContainer');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.id = 'toastContainer';
                toastContainer.className = 'position-fixed top-0 end-0 p-3';
                toastContainer.style.zIndex = '1050';
                document.body.appendChild(toastContainer);
            }
            
            // Create toast
            const toastId = 'toast-' + Date.now();
            const toastHtml = `
                <div id="${toastId}" class="toast align-items-center text-bg-${type} border-0" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHtml);
            
            // Show toast
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement, {
                delay: 3000
            });
            toast.show();
            
            // Remove toast after it's hidden
            toastElement.addEventListener('hidden.bs.toast', function () {
                toastElement.remove();
            });
        }

        // Customer order functions
        function refreshOrders() {
            loadCustomerOrders();
            showToast('Orders refreshed', 'success');
        }

        function viewOrderDetails(orderId) {
            const order = appState.orders.find(o => o.id === orderId);
            if (!order) return;
            
            document.getElementById('modalOrderId').textContent = order.id;
            
            const itemsHtml = order.items.map(item => `
                <div class="d-flex justify-content-between py-2 border-bottom">
                    <div>
                        <strong>${item.name}</strong><br>
                        <small class="text-muted">Quantity: ${item.quantity}</small>
                    </div>
                    <div class="text-end">
                        ${formatCurrency(item.price)} UGX<br>
                        <small class="text-muted">Total: ${formatCurrency(item.price * item.quantity)} UGX</small>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('orderDetailsContent').innerHTML = `
                <div class="mb-4">
                    <h6>Order Information</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Order Date:</strong> ${order.date}</p>
                            <p><strong>Status:</strong> ${getStatusBadge(order.status)}</p>
                            <p><strong>Payment Method:</strong> ${order.paymentMethod}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Payment Status:</strong> 
                                <span class="badge ${order.paymentStatus === 'paid' ? 'bg-success' : 'bg-warning'}">
                                    ${order.paymentStatus}
                                </span>
                            </p>
                            ${order.trackingNumber ? `<p><strong>Tracking Number:</strong> ${order.trackingNumber}</p>` : ''}
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6>Shipping Address</h6>
                    <p>${order.shippingAddress}</p>
                </div>
                
                <div class="mb-4">
                    <h6>Order Items</h6>
                    ${itemsHtml}
                </div>
                
                <div class="mb-4">
                    <h6>Order Summary</h6>
                    <div class="d-flex justify-content-between mb-1">
                        <span>Subtotal:</span>
                        <span>${formatCurrency(order.subtotal)} UGX</span>
                    </div>
                    <div class="d-flex justify-content-between mb-1">
                        <span>Tax (18%):</span>
                        <span>${formatCurrency(order.tax)} UGX</span>
                    </div>
                    <div class="d-flex justify-content-between mb-1">
                        <span>Shipping:</span>
                        <span>${formatCurrency(order.shipping)} UGX</span>
                    </div>
                    <div class="d-flex justify-content-between fw-bold mt-2 pt-2 border-top">
                        <span>Total:</span>
                        <span>${formatCurrency(order.finalTotal)} UGX</span>
                    </div>
                </div>
            `;
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('orderDetailsModal'));
            modal.show();
        }

        // Enhanced admin order functions
        function updateOrderStatus(status) {
            const checkboxes = document.querySelectorAll('.order-checkbox:checked');
            if (checkboxes.length === 0) {
                showToast('Please select at least one order', 'warning');
                return;
            }
            
            checkboxes.forEach(checkbox => {
                const orderId = parseInt(checkbox.value);
                const order = appState.orders.find(o => o.id === orderId);
                if (order) {
                    order.status = status;
                    
                    // Add notification for status change
                    if (appState.userType === 'admin') {
                        appState.notifications.push({
                            id: appState.notifications.length + 1,
                            type: "order",
                            title: "Order Status Updated",
                            message: `Order #${orderId} marked as ${status}`,
                            time: "Just now",
                            read: false
                        });
                    }
                }
            });
            
            loadAdminOrders();
            showToast(`${checkboxes.length} order(s) updated to ${status}`, 'success');
        }

        function cancelSelectedOrders() {
            const checkboxes = document.querySelectorAll('.order-checkbox:checked');
            if (checkboxes.length === 0) {
                showToast('Please select at least one order', 'warning');
                return;
            }
            
            if (confirm(`Are you sure you want to cancel ${checkboxes.length} order(s)?`)) {
                checkboxes.forEach(checkbox => {
                    const orderId = parseInt(checkbox.value);
                    const order = appState.orders.find(o => o.id === orderId);
                    if (order) {
                        order.status = 'cancelled';
                    }
                });
                
                loadAdminOrders();
                showToast(`${checkboxes.length} order(s) cancelled`, 'success');
            }
        }

        function exportOrders(format) {
            let exportData = '';
            
            if (format === 'csv') {
                exportData = 'Order ID,Customer,Date,Items,Total,Status\n';
                appState.orders.forEach(order => {
                    exportData += `${order.id},${order.customerName},${order.date},"${order.items.map(i => i.name).join(', ')}",${order.finalTotal},${order.status}\n`;
                });
            } else {
                // Simulate PDF export
                exportData = 'PDF export would be generated here';
            }
            
            // Create download link
            const link = document.createElement('a');
            link.download = `orders_${new Date().toISOString().split('T')[0]}.${format}`;
            link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(exportData);
            link.click();
            
            showToast(`Orders exported as ${format.toUpperCase()}`, 'success');
        }

        // Initialize notifications interval
        setTimeout(() => {
            startNotificationUpdateInterval();
        }, 1000);
    </script>
</body>
</html>